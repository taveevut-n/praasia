<?php class nDB { var $lid=0;var $qid=0;var $row;var $record=array();var $error="";var $errno="";function connect() { if ($this->lid==0) { $this->lid=mysql_pconnect(DB_HOST,DB_USER,DB_PWD);if (!$this->lid) { $this->halt("connect(".DB_HOST.",".DB_USER.",PASSWORD) failed.");} if (!@mysql_select_db(DB_NAME,$this->lid)) { $this->halt("Can not connect DB ".DB_NAME);return false;} } return $this->lid;} function query($q) { if (empty($q)) return false;if (!$this->connect()) { return false;} if ($this->qid) { @mysql_free_result($this->qid);$this->qid=0;} $this->qid=@mysql_query($q,$this->lid);$this->row =0;$this->errno=mysql_errno();$this->error=mysql_error();if (!$this->qid) { $this->halt("Invalid SQL:".$q);} return $this->qid;} function next_record() { if (!$this->qid) { $this->halt("No Data REquest.");return false;} $this->record=@mysql_fetch_array($this->qid);$this->row +=1;$this->errno =mysql_errno();$this->error =mysql_error();$stat=is_array($this->record);return $stat;} function f($field_name) { return stripslashes($this->record[$field_name]);} function p($field_name) { print stripslashes($this->record[$field_name]);} function num_rows() { if ($this->lid) { return @mysql_numrows($this->qid);}else{ return false;} } function halt($msg) { $this->error=@mysql_error($this->lid);$this->errno=@mysql_errno($this->lid);printf("</td></tr></table><b>Error:</b> %s<br>\n",$msg);printf("<b>MySQL Error </b>:%s (%s)<br>\n",$this->errno,$this->error);exit;} } ?>
